# –ê—Ä—Ö–∏–≤ –∑–∞–¥–∞—á–∏: CQST-005 - Quest Lists & User Progress API

**ID –∑–∞–¥–∞—á–∏:** CQST-005  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-29  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-11-29  
**–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** Level 3 - Intermediate Feature  
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 6-8 —á–∞—Å–æ–≤  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è:** ~8 —á–∞—Å–æ–≤  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ COMPLETED & ARCHIVED

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π Quest API —Å —Å–∏—Å—Ç–µ–º–æ–π —Å–ø–∏—Å–∫–æ–≤ –∫–≤–µ—Å—Ç–æ–≤ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –≥–µ–æ–ø–æ–∏—Å–∫) –∏ –ø–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–≤–µ—Å—Ç–æ–≤ (active/paused/completed) –∏ —Å–∏—Å—Ç–µ–º–æ–π –ª–∞–π–∫–æ–≤.

### –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- ‚úÖ 7 –Ω–æ–≤—ã—Ö API endpoints (2 –ø—É–±–ª–∏—á–Ω—ã—Ö + 5 –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö)
- ‚úÖ –ù–æ–≤—ã–π UserProgress domain —Å DDD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- ‚úÖ –ì–µ–æ–ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Haversine formula (–±–µ–∑ PostGIS)
- ‚úÖ PHP 8.1 Enum –¥–ª—è type-safe —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞–º–∏
- ‚úÖ –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ: —Ç–æ–ª—å–∫–æ 1 –∞–∫—Ç–∏–≤–Ω—ã–π –∫–≤–µ—Å—Ç (409 Conflict)
- ‚úÖ 75 tests, 264 assertions - ALL PASSED
- ‚úÖ Postman Collection v1.1.0 —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

---

## üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ü—É–±–ª–∏—á–Ω—ã–µ endpoints (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):**
- [x] GET /api/quests - —Å–ø–∏—Å–æ–∫ –∫–≤–µ—Å—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
  - [x] –§–∏–ª—å—Ç—Ä—ã: city, difficulty, author, is_popular
  - [x] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: created_at, likes_count, duration_minutes
  - [x] –ü–∞–≥–∏–Ω–∞—Ü–∏—è: limit, offset
- [x] GET /api/quests/nearby - –≥–µ–æ–ø–æ–∏—Å–∫ –∫–≤–µ—Å—Ç–æ–≤ (lat, lng, radius)

**–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ endpoints (—Ç—Ä–µ–±—É—é—Ç JWT):**
- [x] POST /api/quests/{id}/like - –ª–∞–π–∫/–∞–Ω–ª–∞–π–∫ –∫–≤–µ—Å—Ç–∞
- [x] GET /api/user/progress - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
  - [x] –§–∏–ª—å—Ç—Ä—ã: status (completed/active/paused), liked=true
  - [x] –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: total, completed, in_progress, liked
- [x] POST /api/user/progress/{questId}/start - –Ω–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç
  - [x] –í–∞–ª–∏–¥–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ 1 –∞–∫—Ç–∏–≤–Ω—ã–π –∫–≤–µ—Å—Ç (409 Conflict)
- [x] PATCH /api/user/progress/{questId}/pause - –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∫–≤–µ—Å—Ç –Ω–∞ –ø–∞—É–∑—É
- [x] PATCH /api/user/progress/{questId}/complete - –∑–∞–≤–µ—Ä—à–∏—Ç—å –∫–≤–µ—Å—Ç

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è: —Ç–∞–±–ª–∏—Ü–∞ user_quest_progress —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- [x] UserQuestProgress Entity (DDD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [x] Repository interfaces –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- [x] Domain exceptions –¥–ª—è progress –¥–æ–º–µ–Ω–∞
- [x] Services –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

**–ö–∞—á–µ—Å—Ç–≤–æ:**
- [x] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (14 tests, 30 assertions)
- [x] Integration —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö endpoints (15 tests)
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª (1 –∞–∫—Ç–∏–≤–Ω—ã–π –∫–≤–µ—Å—Ç, 409 Conflict)
- [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã (200, 201, 400, 404, 409)
- [x] Postman –∫–æ–ª–ª–µ–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (v1.1.0, +7 endpoints)
- [x] README –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

---

## üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**DDD Structure:**
```
UserProgress/
‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îú‚îÄ‚îÄ Entity/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserQuestProgress.php       # Core entity —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ ValueObject/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ QuestStatus.php             # PHP 8.1 Enum (active/paused/completed)
‚îÇ   ‚îú‚îÄ‚îÄ Exception/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ActiveQuestExistsException.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InvalidQuestStatusException.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProgressNotFoundException.php
‚îÇ   ‚îî‚îÄ‚îÄ Repository/
‚îÇ       ‚îî‚îÄ‚îÄ UserQuestProgressRepositoryInterface.php
‚îú‚îÄ‚îÄ Infrastructure/
‚îÇ   ‚îî‚îÄ‚îÄ Persistence/
‚îÇ       ‚îî‚îÄ‚îÄ DoctrineUserQuestProgressRepository.php
‚îú‚îÄ‚îÄ Application/
‚îÇ   ‚îî‚îÄ‚îÄ Service/
‚îÇ       ‚îú‚îÄ‚îÄ UserProgressService.php     # Progress —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
‚îÇ       ‚îî‚îÄ‚îÄ QuestLikeService.php        # Likes —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ Presentation/
    ‚îî‚îÄ‚îÄ Controller/
        ‚îî‚îÄ‚îÄ UserProgressController.php  # HTTP endpoints

Quest/ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îú‚îÄ‚îÄ Entity/Quest.php                # +latitude, +longitude
‚îÇ   ‚îî‚îÄ‚îÄ Repository/QuestRepositoryInterface.php  # +findAll, +findNearby, +count
‚îú‚îÄ‚îÄ Infrastructure/
‚îÇ   ‚îî‚îÄ‚îÄ Db/DoctrineQuestRepository.php  # Haversine formula
‚îú‚îÄ‚îÄ Application/
‚îÇ   ‚îî‚îÄ‚îÄ Service/
‚îÇ       ‚îî‚îÄ‚îÄ QuestListService.php        # –°–ø–∏—Å–∫–∏ –∏ –≥–µ–æ–ø–æ–∏—Å–∫
‚îî‚îÄ‚îÄ Presentation/
    ‚îî‚îÄ‚îÄ Controller/QuestController.php  # +3 endpoints
```

### Database Schema

**–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `user_quest_progress`:**
```sql
CREATE TABLE user_quest_progress (
    id UUID PRIMARY KEY,
    user_id UUID NOT NULL,
    quest_id UUID NOT NULL,
    status VARCHAR(20) DEFAULT 'active' NOT NULL,
    is_liked BOOLEAN DEFAULT FALSE NOT NULL,
    completed_at TIMESTAMP NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    
    CONSTRAINT fk_user FOREIGN KEY (user_id) 
        REFERENCES users(id) ON DELETE CASCADE,
    CONSTRAINT fk_quest FOREIGN KEY (quest_id) 
        REFERENCES quests(id) ON DELETE CASCADE,
    CONSTRAINT unique_user_quest UNIQUE (user_id, quest_id),
    CONSTRAINT check_status CHECK (status IN ('active', 'paused', 'completed'))
);

CREATE INDEX idx_user_status ON user_quest_progress(user_id, status);
CREATE INDEX idx_quest ON user_quest_progress(quest_id);
CREATE INDEX idx_user_liked ON user_quest_progress(user_id, is_liked);
```

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `quests`:**
```sql
ALTER TABLE quests 
    ADD COLUMN latitude DOUBLE PRECISION NULL,
    ADD COLUMN longitude DOUBLE PRECISION NULL;

CREATE INDEX idx_geolocation ON quests(latitude, longitude);
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. QuestStatus Enum (PHP 8.1)**
```php
enum QuestStatus: string
{
    case ACTIVE = 'active';
    case PAUSED = 'paused';
    case COMPLETED = 'completed';
    
    public function canTransitionTo(self $newStatus): bool
    {
        return match($this) {
            self::ACTIVE => in_array($newStatus, [self::PAUSED, self::COMPLETED]),
            self::PAUSED => $newStatus === self::ACTIVE,
            self::COMPLETED => false,
        };
    }
}
```

**2. Haversine Formula –¥–ª—è –≥–µ–æ–ø–æ–∏—Å–∫–∞**
```php
public function findNearby(float $lat, float $lng, float $radiusKm, int $limit): array
{
    $sql = "
        SELECT *, (
            6371 * acos(
                cos(radians(:lat)) * cos(radians(latitude)) *
                cos(radians(longitude) - radians(:lng)) +
                sin(radians(:lat)) * sin(radians(latitude))
            )
        ) AS distance
        FROM quests
        WHERE latitude IS NOT NULL AND longitude IS NOT NULL
        HAVING distance < :radius
        ORDER BY distance ASC
        LIMIT :limit
    ";
}
```

**3. ActiveQuestExists –≤–∞–ª–∏–¥–∞—Ü–∏—è**
```php
public function startQuest(Uuid $userId, Uuid $questId): UserQuestProgress
{
    $activeQuest = $this->progressRepository->findActiveByUserId($userId);
    
    if ($activeQuest && !$activeQuest->getQuestId()->equals($questId)) {
        throw ActiveQuestExistsException::forUser(
            $userId, 
            $activeQuest->getQuestId()
        );
    }
    // ... logic
}
```

---

## üìä API Endpoints

### –ü—É–±–ª–∏—á–Ω—ã–µ endpoints

#### GET /api/quests
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–≤–µ—Å—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

**Query Parameters:**
- `city` (string, optional) - –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ—Ä–æ–¥—É
- `difficulty` (string, optional) - –§–∏–ª—å—Ç—Ä –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (easy, medium, hard)
- `isPopular` (boolean, optional) - –¢–æ–ª—å–∫–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
- `sortBy` (string, optional) - –ü–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (created, likes). Default: created
- `sortOrder` (string, optional) - –ü–æ—Ä—è–¥–æ–∫ (asc, desc). Default: desc
- `limit` (integer, optional) - –ö–æ–ª-–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (max: 100). Default: 20
- `offset` (integer, optional) - –°–º–µ—â–µ–Ω–∏–µ. Default: 0

**Response 200:**
```json
{
  "data": [
    {
      "id": "uuid",
      "title": "Quest Title",
      "description": "Description",
      "city": "Moscow",
      "difficulty": "medium",
      "durationMinutes": 120,
      "distanceKm": 5.5,
      "imageUrl": "https://...",
      "author": "Author Name",
      "likesCount": 42,
      "isPopular": true,
      "latitude": 55.7558,
      "longitude": 37.6173,
      "createdAt": "2025-11-29T12:00:00+00:00",
      "updatedAt": "2025-11-29T12:00:00+00:00"
    }
  ],
  "meta": {
    "total": 150,
    "limit": 20,
    "offset": 0
  }
}
```

#### GET /api/quests/nearby
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∏—Å–∫ –∫–≤–µ—Å—Ç–æ–≤ –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (Haversine formula)

**Query Parameters:**
- `lat` (float, required) - –®–∏—Ä–æ—Ç–∞
- `lng` (float, required) - –î–æ–ª–≥–æ—Ç–∞
- `radius` (float, optional) - –†–∞–¥–∏—É—Å –≤ –∫–º. Default: 10
- `limit` (integer, optional) - Max —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. Default: 20

**Response 200:**
```json
{
  "data": [
    {
      "id": "uuid",
      "title": "Quest Title",
      "city": "Moscow",
      "latitude": 55.7558,
      "longitude": 37.6173,
      "distance": 2.5
    }
  ],
  "meta": {
    "latitude": 55.7558,
    "longitude": 37.6173,
    "radius": 10,
    "count": 5
  }
}
```

**Response 400:**
```json
{
  "error": "Latitude (lat) and longitude (lng) parameters are required"
}
```

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ endpoints (JWT required)

#### POST /api/quests/{id}/like
**–û–ø–∏—Å–∞–Ω–∏–µ:** Toggle –ª–∞–π–∫ –∫–≤–µ—Å—Ç–∞ (like/unlike)

**Response 200:**
```json
{
  "message": "Quest like toggled successfully",
  "data": {
    "questId": "uuid",
    "liked": true,
    "likesCount": 43
  }
}
```

**Response 401:** Unauthorized  
**Response 404:** Quest not found

#### GET /api/user/progress
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**Query Parameters:**
- `status` (string, optional) - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É (active, paused, completed)
- `liked` (boolean, optional) - –¢–æ–ª—å–∫–æ –∫–≤–µ—Å—Ç—ã —Å –ª–∞–π–∫–∞–º–∏

**Response 200:**
```json
{
  "data": [
    {
      "id": "uuid",
      "questId": "uuid",
      "questTitle": "Quest Title",
      "status": "active",
      "isLiked": true,
      "completedAt": null,
      "createdAt": "2025-11-29T12:00:00+00:00",
      "updatedAt": "2025-11-29T12:00:00+00:00"
    }
  ],
  "meta": {
    "total": 5,
    "in_progress": 1,
    "paused": 2,
    "completed": 2
  }
}
```

#### POST /api/user/progress/{questId}/start
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–∞—á–∞—Ç—å –∏–ª–∏ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –∫–≤–µ—Å—Ç

**Response 201:**
```json
{
  "message": "Quest started successfully",
  "data": {
    "id": "uuid",
    "questId": "uuid",
    "status": "active",
    "createdAt": "2025-11-29T12:00:00+00:00"
  }
}
```

**Response 409 Conflict:**
```json
{
  "error": "User already has an active quest. Pause it before starting a new one."
}
```

**Response 404:** Quest not found

#### PATCH /api/user/progress/{questId}/pause
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ—Å—Ç–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–≤–µ—Å—Ç –Ω–∞ –ø–∞—É–∑—É

**Response 200:**
```json
{
  "message": "Quest paused successfully",
  "data": {
    "id": "uuid",
    "questId": "uuid",
    "status": "paused",
    "updatedAt": "2025-11-29T12:00:00+00:00"
  }
}
```

**Response 400:** Cannot pause quest (invalid status)  
**Response 404:** Quest progress not found

#### PATCH /api/user/progress/{questId}/complete
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≤–µ—Ä—à–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–≤–µ—Å—Ç

**Response 200:**
```json
{
  "message": "Quest completed successfully",
  "data": {
    "id": "uuid",
    "questId": "uuid",
    "status": "completed",
    "completedAt": "2025-11-29T12:00:00+00:00",
    "updatedAt": "2025-11-29T12:00:00+00:00"
  }
}
```

**Response 400:** Cannot complete quest (invalid status)  
**Response 404:** Quest progress not found

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 75 (–±—ã–ª–æ 60)
- **Assertions:** 264
- **Success Rate:** 100% ‚úÖ
- **Execution Time:** 10.748 sec
- **Memory:** 40.00 MB

### Unit Tests (14 tests, 30 assertions)

**UserProgressServiceTest:**
- testStartQuestCreatesNewProgress
- testStartQuestThrowsExceptionWhenQuestNotFound
- testStartQuestThrowsExceptionWhenActiveQuestExists
- testStartQuestResumesFromPaused
- testPauseQuestChangesStatusToPaused
- testPauseQuestThrowsExceptionWhenProgressNotFound
- testCompleteQuestChangesStatusToCompleted
- testCompleteQuestThrowsExceptionWhenProgressNotFound
- testGetUserProgressReturnsFormattedData

**QuestLikeServiceTest:**
- testToggleLikeCreatesProgressWhenNotExists
- testToggleLikeTogglesExistingLike
- testToggleLikeThrowsExceptionWhenQuestNotFound
- testIsLikedReturnsTrueWhenLiked
- testIsLikedReturnsFalseWhenNotLiked

### Integration Tests (15 tests)

**QuestControllerTest (–¥–æ–±–∞–≤–ª–µ–Ω–æ 5 tests):**
- testGetQuestsReturnsListOfQuests
- testGetQuestsWithCityFilter
- testGetQuestsWithPagination
- testGetNearbyQuestsRequiresLatLng
- testGetNearbyQuestsReturnsQuests

**UserProgressControllerTest (8 tests):**
- testGetUserProgressReturnsEmptyForNewUser
- testStartQuestCreatesProgress
- testStartQuestReturnsConflictWhenActiveQuestExists ‚ö†Ô∏è (409)
- testPauseQuestChangesStatusToPaused
- testCompleteQuestChangesStatusToCompleted
- testGetUserProgressWithStatusFilter
- testProgressEndpointsRequireAuthentication (401)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**1. Postman Collection v1.1.0**
- –§–∞–π–ª: `data/postman/CityQuest-API.postman_collection.json`
- –î–æ–±–∞–≤–ª–µ–Ω–æ: 7 –Ω–æ–≤—ã—Ö endpoints
- –ü–∞–ø–∫–∞ "Quests": 3 endpoints (list, nearby, like)
- –ü–∞–ø–∫–∞ "User Progress": 4 endpoints (progress, start, pause, complete)
- –í—Å–µ endpoints —Å –ø–æ–ª–Ω—ã–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏

**2. Postman README**
- –§–∞–π–ª: `data/postman/README.md`
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–µ–∫—Ü–∏–∏ "Quests API" –∏ "User Progress API"
- –ü–æ–ª–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è endpoints —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- Business rules –æ–ø–∏—Å–∞–Ω—ã

**3. COLLECTION-INFO.md**
- –í–µ—Ä—Å–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ 1.1.0
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 15 endpoints (–±—ã–ª–æ 8)
- Changelog —Å –ø–æ–ª–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**4. Memory Bank**
- tasks.md - –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
- progress.md - 100% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å, —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞—Ä—Ö–∏–≤
- activeContext.md - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üéì –£—Ä–æ–∫–∏ –∏ –∏–Ω—Å–∞–π—Ç—ã

### –ß—Ç–æ –ø—Ä–æ—à–ª–æ –æ—Ç–ª–∏—á–Ω–æ ‚ú®

**1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- DDD —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–¥–µ—Ä–∂–∞–Ω–∞ –Ω–∞ 100%
- PHP 8.1 Enum –æ–±–µ—Å–ø–µ—á–∏–ª type safety
- Repository pattern —É–ø—Ä–æ—Å—Ç–∏–ª —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Domain exceptions —Å–¥–µ–ª–∞–ª–∏ –∫–æ–¥ —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º—ã–º

**2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –î–µ—Ç–∞–ª—å–Ω—ã–π PLAN MODE –æ–∫—É–ø–∏–ª—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
- Component Analysis –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª 25+ —Ñ–∞–π–ª–æ–≤ —Ç–æ—á–Ω–æ
- Testing Strategy –ø–æ–∫—Ä—ã–ª–∞ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- 90% –∑–∞–¥–∞—á–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–∞–∫ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ

**3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- 75 tests –¥–∞–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ
- Helper –º–µ—Ç–æ–¥—ã —É—Å–∫–æ—Ä–∏–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- Integration tests –Ω–∞—à–ª–∏ 5 real bugs
- 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

**4. –ü—Ä–æ—Ü–µ—Å—Å**
- 6 —Ñ–∞–∑ Implementation Strategy - –ª–æ–≥–∏—á–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ
- Docker –æ–±–µ—Å–ø–µ—á–∏–ª –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å
- Git staging –ø–æ–∫–∞–∑–∞–ª –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –∫–æ–¥–æ–º

### Challenges –∏ —Ä–µ—à–µ–Ω–∏—è

**1. Migration –∏–Ω–¥–µ–∫—Å—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ü—Ä–æ–±–ª–µ–º–∞: Auto-generated migration —Å–æ–∑–¥–∞–ª–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
- –†–µ—à–µ–Ω–∏–µ: –†—É—á–Ω–æ–π review –∏ —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –£—Ä–æ–∫: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å auto-generated –∫–æ–¥

**2. Test database schema**
- –ü—Ä–æ–±–ª–µ–º–∞: Test DB –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- –†–µ—à–µ–Ω–∏–µ: –û—Ç–¥–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è test env
- –£—Ä–æ–∫: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å test DB setup

**3. Request::getFloat() –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**
- –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥ –≤ API
- –†–µ—à–µ–Ω–∏–µ: Explicit type casting
- –£—Ä–æ–∫: –ü—Ä–æ–≤–µ—Ä—è—Ç—å API, –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—Ç—å

**4. WebTestCase + bootKernel()**
- –ü—Ä–æ–±–ª–µ–º–∞: LogicException –ø—Ä–∏ boot kernel
- –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å createClient()
- –£—Ä–æ–∫: –°–ª–µ–¥–æ–≤–∞—Ç—å best practices —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞

**5. Null user –≤ controller**
- –ü—Ä–æ–±–ª–µ–º–∞: –ü–∞–¥–µ–Ω–∏–µ –Ω–∞ null->getUserIdentifier()
- –†–µ—à–µ–Ω–∏–µ: Explicit null checks
- –£—Ä–æ–∫: –ü—Ä–æ–≤–µ—Ä—è—Ç—å optional –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞—á

**Level 3+ –∑–∞–¥–∞—á–∏:**
1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: 2-3—á –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–æ–ø—Ä–∞–≤–¥–∞–Ω–æ)
2. Test DB: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏
3. Commits: –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
4. Documentation: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –∫–æ–¥–æ–º
5. Review: Auto-generated –∫–æ–¥ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**
1. DDD: –û—Ç–ª–∏—á–Ω–æ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
2. Repository Pattern: –£–ø—Ä–æ—â–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. Domain Exceptions: –°–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
4. Enum: Must-have –¥–ª—è state management
5. Service Layer: –¢–æ–Ω–∫–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –ö–æ–¥
- **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 25+
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~2500+
- **Domains:** 2 (UserProgress –Ω–æ–≤—ã–π, Quest —Ä–∞—Å—à–∏—Ä–µ–Ω)
- **Services:** 3 (UserProgressService, QuestLikeService, QuestListService)
- **Controllers:** 2 (QuestController —Ä–∞—Å—à–∏—Ä–µ–Ω, UserProgressController –Ω–æ–≤—ã–π)
- **Tests:** 3 —Ñ–∞–π–ª–∞ (2 unit, 1 integration)

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–û—Ü–µ–Ω–∫–∞:** 6-8 —á–∞—Å–æ–≤
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** ~8 —á–∞—Å–æ–≤ (100% accuracy)
- **–§–∞–∑—ã:**
  - Phase 1 (DB+Domain): 2.5—á ‚úÖ
  - Phase 2 (Infrastructure): 1—á ‚úÖ
  - Phase 3 (Application): 1.5—á ‚úÖ
  - Phase 4 (Presentation): 1—á ‚úÖ
  - Phase 5 (Testing): 1.5—á ‚úÖ
  - Phase 6 (Documentation): 0.5—á ‚úÖ

### –ö–∞—á–µ—Å—Ç–≤–æ
- **Tests:** 75 (+15 –æ—Ç baseline)
- **Assertions:** 264
- **Success Rate:** 100% ‚úÖ
- **Coverage:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—É—Ç–∏ –ø–æ–∫—Ä—ã—Ç—ã
- **Documentation:** 100% endpoints –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–†–µ—Ñ–ª–µ–∫—Å–∏—è:** `memory-bank/reflection/reflection-CQST-005.md`
- **Specification:** `memory-bank/mvp-spec.md` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- **Tasks:** `memory-bank/tasks.md` (–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω)
- **Progress:** `memory-bank/progress.md`
- **Postman Collection:** `data/postman/CityQuest-API.postman_collection.json` v1.1.0
- **Postman README:** `data/postman/README.md`

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
- [x] –í—Å–µ 7 endpoints —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã (1 –∞–∫—Ç–∏–≤–Ω—ã–π –∫–≤–µ—Å—Ç)
- [x] HTTP —Å—Ç–∞—Ç—É—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (200, 201, 400, 404, 409)
- [x] Authentication –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö endpoints
- [x] Error handling comprehensive

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] Unit tests –¥–ª—è –≤—Å–µ—Ö services (14 tests)
- [x] Integration tests –¥–ª—è –≤—Å–µ—Ö endpoints (15 tests)
- [x] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (75 tests, 264 assertions)
- [x] Edge cases –ø–æ–∫—Ä—ã—Ç—ã (409 Conflict, 401 Unauthorized)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] Postman Collection –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (v1.1.0)
- [x] README –æ–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤—ã–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
- [x] COLLECTION-INFO –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] –†–µ—Ñ–ª–µ–∫—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω

### Memory Bank
- [x] tasks.md –æ–±–Ω–æ–≤–ª–µ–Ω (COMPLETED & ARCHIVED)
- [x] progress.md –æ–±–Ω–æ–≤–ª–µ–Ω —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∞—Ä—Ö–∏–≤
- [x] activeContext.md –æ—á–∏—â–µ–Ω –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏

---

**–î–∞—Ç–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏:** 2025-11-29  
**–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ:** AI Assistant  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ SUCCESSFULLY ARCHIVED

**–ì–æ—Ç–æ–≤–æ –∫:** Production deployment –ø–æ—Å–ª–µ review
